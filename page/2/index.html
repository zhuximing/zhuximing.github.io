<!DOCTYPE html>
<html lang=zh>
<head>
    <meta charset="utf-8">
    
    <title>问道学院博客</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <meta property="og:type" content="website">
<meta property="og:title" content="问道学院博客">
<meta property="og:url" content="http://www.wendaoxueyuan.com/page/2/index.html">
<meta property="og:site_name" content="问道学院博客">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="问道学院博客">
    

    
        <link rel="alternate" href="/" title="问道学院博客" type="application/atom+xml" />
    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/open-sans/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/2.1.3/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
    
    


</head>

<body>
    <div id="container">
        <header id="header">
    <div id="header-main" class="header-inner">
        <div class="outer">
            <a href="/" id="logo">
                <i class="logo"></i>
                <span class="site-title">问道学院博客</span>
            </a>
            <nav id="main-nav">
                
                    <a class="main-nav-link" href="/.">LINUX</a>
                
                    <a class="main-nav-link" href="/archives">归档</a>
                
                    <a class="main-nav-link" href="/categories">Categories</a>
                
                    <a class="main-nav-link" href="/tags">Tags</a>
                
                    <a class="main-nav-link" href="/about">About</a>
                
            </nav>
            
                
                <nav id="sub-nav">
                    <div class="profile" id="profile-nav">
                        <a id="profile-anchor" href="javascript:;">
                            <img class="avatar" src="/css/images/avatar.png" />
                            <i class="fa fa-caret-down"></i>
                        </a>
                    </div>
                </nav>
            
            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="想要查找什么..." />
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: '文章',
            PAGES: '页面',
            CATEGORIES: '分类',
            TAGS: '标签',
            UNTITLED: '(未命名)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
        </div>
    </div>
    <div id="main-nav-mobile" class="header-sub header-inner">
        <table class="menu outer">
            <tr>
                
                    <td><a class="main-nav-link" href="/.">LINUX</a></td>
                
                    <td><a class="main-nav-link" href="/archives">归档</a></td>
                
                    <td><a class="main-nav-link" href="/categories">Categories</a></td>
                
                    <td><a class="main-nav-link" href="/tags">Tags</a></td>
                
                    <td><a class="main-nav-link" href="/about">About</a></td>
                
                <td>
                    
    <div class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="搜索" />
    </div>

                </td>
            </tr>
        </table>
    </div>
</header>

        <div class="outer">
            
                

<aside id="profile">
    <div class="inner profile-inner">
        <div class="base-info profile-block">
            <img id="avatar" src="/css/images/avatar.png" />
            <h2 id="name">朱锡铭</h2>
            <h3 id="title">问道学院创始人,专注it技术一辈子</h3>
            <span id="location"><i class="fa fa-map-marker"></i>武汉，中国</span>
            <a id="follow" target="_blank" href="https://github.com/zhuximing">关注我</a>
        </div>
        <div class="article-info profile-block">
            <div class="article-info-block">
                34
                <span>文章</span>
            </div>
            <div class="article-info-block">
                0
                <span>标签</span>
            </div>
        </div>
        
        <div class="profile-block social-links">
            <table>
                <tr>
                    
                    
                    <td>
                        <a href="https://github.com/zhuximing" target="_blank" title="github" class=tooltip>
                            <i class="fa fa-github"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="twitter" class=tooltip>
                            <i class="fa fa-twitter"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="facebook" class=tooltip>
                            <i class="fa fa-facebook"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="dribbble" class=tooltip>
                            <i class="fa fa-dribbble"></i>
                        </a>
                    </td>
                    
                    <td>
                        <a href="/" target="_blank" title="rss" class=tooltip>
                            <i class="fa fa-rss"></i>
                        </a>
                    </td>
                    
                </tr>
            </table>
        </div>
        
    </div>
</aside>

            
            <section id="main">
    <article id="post-spring-e6-95-b4-e5-90-88-e9-82-ae-e4-bb-b6-e5-8a-9f-e8-83-bd" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/07/30/spring-e6-95-b4-e5-90-88-e9-82-ae-e4-bb-b6-e5-8a-9f-e8-83-bd/">spring整合邮件功能</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/07/30/spring-e6-95-b4-e5-90-88-e9-82-ae-e4-bb-b6-e5-8a-9f-e8-83-bd/">
            <time datetime="2017-07-30T06:58:45.000Z" itemprop="datePublished">2017-07-30</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/JAVA-WEB/">JAVA_WEB</a>
    </div>

                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p><pre>说明:Spring的邮件发送的核心是MailSender接口，在Spring3.0中提供了一个实现类JavaMailSenderImpl，这个类是发送邮件的核心类。可以在spring配置文件中配置使用，当然也可以自己硬编码到代码中。</pre><br>1:在pom.xml依赖jar<br>[cc lang=”xml”]</p>
<p><dependency><br>         <groupid>org.springframework</groupid><br>         <artifactid>spring-context-support</artifactid><br>         <version>4.2.4.RELEASE</version><br>    </dependency><br>    <dependency><br>         <groupid>javax.mail</groupid><br>         <artifactid>mail</artifactid><br>         <version>1.4.7</version><br>    </dependency><br>[/cc]<br>2:新建mail.properties文件</p>
<p><pre class="prettyprint"><img src="http://139.199.74.187/blog/wp-content/uploads/2017/07/2017-07-30_153555-300x141.png" alt=""><br>内容如下：<br>mail.host=smtp.qq.com<br>mail.username=569591357@qq.com<br>mail.password=cknsxsxtxmvtbdif</pre><br>3:在springmvc.xml中加入如下配置（将发邮件组件交给spring管理）</p>
<p>[cc lang=”xml”]<br><!-- 读取配置文件 --><br>    <context:property-placeholder location="classpath:resource/*.properties"><br>    <!-- 发邮件组件 --><br>    <bean id="mailSender" class="org.springframework.mail.javamail.JavaMailSenderImpl"><br>        <property name="host" value="${mail.host}"></property><br>        <property name="javaMailProperties"><br>            <props><br>                <prop key="mail.smtp.auth">true</prop><br>                <prop key="mail.smtp.timeout">25000</prop><br>            </props><br>        </property><br>        <property name="username" value="${mail.username}"></property><br>        <property name="password" value="${mail.password}"></property><br>    </bean><br>[/cc]</context:property-placeholder></p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.wendaoxueyuan.com/2017/07/30/spring-e6-95-b4-e5-90-88-e9-82-ae-e4-bb-b6-e5-8a-9f-e8-83-bd/" data-id="cj9k57bk9001pyc8v0nss4tlk" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-solr-e9-9b-86-e7-be-a4-e6-90-ad-e5-bb-ba" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/07/29/solr-e9-9b-86-e7-be-a4-e6-90-ad-e5-bb-ba/">solr集群搭建</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/07/29/solr-e9-9b-86-e7-be-a4-e6-90-ad-e5-bb-ba/">
            <time datetime="2017-07-29T15:46:22.000Z" itemprop="datePublished">2017-07-29</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/solor/">solor</a>
    </div>

                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <pre>说明：
1：之前搭建过单机版的solr，现在搭建集群版，我选择共用一个虚拟机，同时可以直接拷贝之前运行solr的tomcat，这样可以免去一些配置，如果你还不会单机版solr搭建请参考[solr单机版服务安装](http://139.199.74.187/blog/?p=190)
2：</pre>

<p>1：拷贝四份tomcat</p>
<p><pre> mkdir /usr/local/solr-cloud<br> cp -r /usr/local/solr/apache-tomcat-7.0.47/ /usr/local/solr-cloud/tomcat01<br> cp -r /usr/local/solr/apache-tomcat-7.0.47/ /usr/local/solr-cloud/tomcat02<br> cp -r /usr/local/solr/apache-tomcat-7.0.47/ /usr/local/solr-cloud/tomcat03<br> cp -r /usr/local/solr/apache-tomcat-7.0.47/ /usr/local/solr-cloud/tomcat04</pre><br>2:由于是伪集群，所以需要改tomcat端口</p>
<p><pre>vim /usr/local/solr-cloud/tomcat01/conf/server.xml<br>&lt;Server port=”8005” shutdown=”SHUTDOWN”&gt;     <span style="color: #00ff00;"> 改成8105</span><br>&lt;Connector port=”8080” protocol=”HTTP/1.1”   <span style="color: #00ff00;"> 改成8180</span><br>&lt;Connector port=”8009” protocol=”AJP/1.3” redirectPort=”8443” /&gt; <span style="color: #00ff00;">改成8109</span><br>还有三个tomcat，同理去改，保证不一样就行</pre><br>3：拷贝四份solr_home</p>
<p><pre> cp -r /usr/local/solr/solr_home/ /usr/local/solr-cloud/solr_home01<br>  cp -r /usr/local/solr/solr_home/ /usr/local/solr-cloud/solr_home02<br>  cp -r /usr/local/solr/solr_home/ /usr/local/solr-cloud/solr_home03<br>  cp -r /usr/local/solr/solr_home/ /usr/local/solr-cloud/solr_home04</pre><br>4:修改solr_home 下面的solr.xml</p>
<p><pre>&lt;solrcloud&gt;<br> &lt;str name=”host”&gt;<span style="color: #ff0000;"><strong>192.168.25.130</strong></span>&lt;/str&gt;<br> &lt;int name=”hostPort”&gt;<strong><span style="color: #ff0000;">8180</span></strong>&lt;/int&gt;<br> &lt;str name=”hostContext”&gt;${hostContext:solr}&lt;/str&gt;<br> &lt;int name=”zkClientTimeout”&gt;${zkClientTimeout:30000}&lt;/int&gt;<br> &lt;bool name=”genericCoreNodeNames”&gt;${genericCoreNodeNames:true}&lt;/bool&gt;<br> &lt;/solrcloud&gt;<br>标红为当前solr_home 所处服务器的ip和对应tomcat端口<br>其他三个对着改就行</pre><br>5:让tomcat01，02，03，04和solr_home01，02，03，04依次关联起来</p>
<p><pre>vim /usr/local/solr-cloud/tomcat01/webapps/solr/WEB-INF/web.xml</pre></p>
<p> &lt;env-entry&gt;<br> &lt;env-entry-name&gt;solr/home&lt;/env-entry-name&gt;<br> &lt;env-entry-value&gt;<strong><span style="color: #ff0000;">/usr/local/solr-cloud/solr_home01</span></strong>&lt;/env-entry-value&gt;<br> &lt;env-entry-type&gt;java.lang.String&lt;/env-entry-type&gt;<br> &lt;/env-entry&gt;<br>对应去修改标红的地方<br>6：让zookeeper统一管理配置文件。需要把solr_home/collection1/conf目录上传到zookeeper。上传任意solr_home中的配置文件即可。</p>
<p><pre><span style="color: #ff0000;">找到上传工具zkCli.sh</span><br>cd /usr/local/solr/<strong><span style="color: #ff0000;">solr-4.10.3</span></strong>/example/scripts/cloud-scripts</pre></p>
<p><strong><span style="color: #ff0000;">千万注意 ：上传之前保证以下2点</span></strong><br>1：关闭zookeeper服务器防火墙<br>/etc/init.d/iptables stop<br>chkconfig –level 35 iptables off<br>2：开启zookeeper集群服务</p>
<p><span style="color: #ff0000;">执行上传</span> ./zkcli.sh -zkhost 192.168.25.131:2181,192.168.25.131:2182,192.168.25.131:2183 -cmd upconfig -confdir /usr/local/solr-cloud/solr_home01/collection1/conf -confname myconf<br>7：去zookeeper中查看下是否上传成功</p>
<p><pre>连接到192.168.25.131 服务器<br>cd /usr/local/zookeeper-cluster/zookeeper01/bin/<br>执行命令: ./zkCli.sh 连接到zookeeper服务器</pre></p>
<p>[zk: localhost:2181(CONNECTED) 0] <span style="color: #ff0000;">ls /</span><br>[<strong><span style="color: #ff0000;">configs</span></strong>, zookeeper]<br>[zk: localhost:2181(CONNECTED) 1]<br>如果有configs证明上传成功！！！！！！<br>8：修改solr tomcat/bin目录下的catalina.sh 文件，关联solr和zookeeper。</p>
<p><pre>  vim /usr/local/solr-cloud/tomcat01/bin/catalina.sh<br> <img src="http://139.199.74.187/blog/wp-content/uploads/2017/07/AA-300x83.jpg" alt=""></pre></p>
<p>添加：<br>JAVA_OPTS=”-DzkHost=192.168.25.131:2181,192.168.25.131:2182,192.168.25.131:2183”<br>其他两个tomcat同理,配完后solr tomcat集群就已经知道zookeeper集群地址了，taomcat会主动连接zookeeper，将自身信息（ip、端口）发送给zookeeper。<br>9：批处理启动每个tomcat实例。<span style="color: #ff0000;">要保证zookeeper集群是启动状态。</span></p>
<p><pre> vim /usr/local/solr-cloud/start-tomcat-all.sh<br>添加：<br>/usr/local/solr-cloud/tomcat01/bin/startup.sh<br>/usr/local/solr-cloud/tomcat02/bin/startup.sh<br>/usr/local/solr-cloud/tomcat03/bin/startup.sh<br>/usr/local/solr-cloud/tomcat04/bin/startup.sh<br>权限<br>chmod u+x /usr/local/solr-cloud/start-tomcat-all.sh<br>启动<br>/usr/local/solr-cloud/start-tomcat-all.sh</pre><br>10:访问集群(,访问集群中其中一个tomcat即可)</p>
<p><img src="http://139.199.74.187/blog/wp-content/uploads/2017/07/dd-300x145.png" alt=""></p>
<p>11：创建新的Collection进行分片处理。直接在浏览器地址栏执行即可，注意修改服务器地址</p>
<p><pre><a href="http://192.168.25.130:8180/solr/admin/collections?action=CREATE&amp;name=collection2&amp;numShards=2&amp;replicationFactor=2" target="_blank" rel="external">http://192.168.25.130:8180/solr/admin/collections?action=CREATE&amp;name=collection2&amp;numShards=2&amp;replicationFactor=2</a><br><img src="http://139.199.74.187/blog/wp-content/uploads/2017/07/2017-07-30_095506-300x58.png" alt=""><br>在每个solr_home下面分别创建了新的collection<br><img src="http://139.199.74.187/blog/wp-content/uploads/2017/07/2017-07-30_095654-300x59.png" alt=""></pre></p>
<p>讨论：我访问的是tomcat01的solr，为什么其他3个solr_home也新建了新的collection？<br>答：4个tomcat间无法直接相互通讯，但是每个tomcat都能跟zookeeper通讯，其实是通过zookeeper中间层，实现每个solr_home 都能新建新的collection<br>12删除不用的Collection。</p>
<p><pre><a href="http://192.168.25.130:8180/solr/admin/collections?action=DELETE&amp;name=collection1" target="_blank" rel="external">http://192.168.25.130:8180/solr/admin/collections?action=DELETE&amp;name=collection1</a><br>讨论：为什么一删则4个tomcat全删，怎么做到的？<br>答：还是zookeeper中间层起到统一管理作用。</pre><br>总结：通过以上配置，验证了solr集群架构</p>
<p><img src="http://139.199.74.187/blog/wp-content/uploads/2017/07/2017-07-30_100739-300x202.png" alt=""></p>
<p>&nbsp;</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.wendaoxueyuan.com/2017/07/29/solr-e9-9b-86-e7-be-a4-e6-90-ad-e5-bb-ba/" data-id="cj9k57bk4001kyc8vtpw6j1t5" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-zookeeper-e9-85-8d-e7-bd-ae-e8-af-b4-e6-98-8e" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/07/29/zookeeper-e9-85-8d-e7-bd-ae-e8-af-b4-e6-98-8e/">zookeeper配置说明</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/07/29/zookeeper-e9-85-8d-e7-bd-ae-e8-af-b4-e6-98-8e/">
            <time datetime="2017-07-29T12:52:33.000Z" itemprop="datePublished">2017-07-29</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/dubbo/">dubbo</a>
    </div>

                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p><pre>tickTime=2000<br>initLimit=10<br>syncLimit=5<br>dataDir=/usr/local/zookeeper-cluster/zookeeper01/data<br>dataLogDir=/usr/local/zookeeper-cluster/zookeeper01/logs<br>clientPort=2181<br>server.1=192.168.25.131:2881:3881<br>server.2=192.168.25.131:2882:3882<br>server.3=192.168.25.131:2883:3883</pre><br>note:</p>
<p><pre>tickTime=2000:<br>心态检测，zookeeper之间互为客户端和服务器端，客户端会向服务端发送检测，证明自己还活着，单位为毫秒<br>initLimit=10：<br>集群中的follower服务器(F)与leader服务器(L)之间<strong><span style="color: #ff0000;">初始连接时</span></strong>能容忍的最多心跳数（tickTime的数量）。（<span style="color: #ff0000;">注意：这里的客户端和服务器端都是zookeeper</span>）<br>syncLimit=5<br>集群中的follower服务器与leader服务器之间<strong><span style="color: #ff0000;">请求和应答</span></strong>之间能容忍的最多心跳数（tickTime的数量）。<br>clientPort=2181<br>客户端(dubbo服务)连接 Zookeeper 服务器的端口，Zookeeper 会监听这个端口，接受客户端的访问请求。<br>server.N=YYY:A:B<br>N:zookeeper服务器编号<br>YYY:zookeeper服务器ip地址<br>A:为LF通信端口，表示该服务器与集群中的leader交换的信息的端口。<br>B:为选举端口，表示选举新leader时服务器间相互通信的端口（当leader挂掉时，其余服务器会相互通信，选择出新的leader）。一般来说，集群中每个服务器的A端口都是一样，每个服务器的B端口也是一样。但是当所采用的为伪集群时，IP地址都一样，只能时A端口和B端口不一样。</pre><br>&nbsp;</p>
<p>&nbsp;</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.wendaoxueyuan.com/2017/07/29/zookeeper-e9-85-8d-e7-bd-ae-e8-af-b4-e6-98-8e/" data-id="cj9k57bkh001tyc8v7lsh77eh" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-zookeeper-e9-9b-86-e7-be-a4-e6-90-ad-e5-bb-ba" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/07/29/zookeeper-e9-9b-86-e7-be-a4-e6-90-ad-e5-bb-ba/">zookeeper-集群版</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/07/29/zookeeper-e9-9b-86-e7-be-a4-e6-90-ad-e5-bb-ba/">
            <time datetime="2017-07-29T08:37:20.000Z" itemprop="datePublished">2017-07-29</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/dubbo/">dubbo</a>
    </div>

                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p><pre><span style="color: #ff0000;">说明</span>:<br>zookeeper集群中只有过半的节点是正常的情况下，那么整个集群是对外可用的，正式基于这么一个特性，zookeeper集群的节点数量为zn+1 最少要3台.<br>我这里采用的还是伪集群，也就是在一台虚拟机上跑3个zookeeper。</pre><br>前提：<a href="http://139.199.74.187/blog/?p=36" target="_blank" rel="external">搭建java运行环境</a></p>
<p>1:上传zookeeper压缩包到服务器（这步大家应该都没什么问题）</p>
<p>2：将zookeeper压缩包解压到/usr/local/zookeeper-cluster中</p>
<p><pre>midir -p /usr/local/zookeeper-cluster<br>[root@localhost ~]# tar -zxvf zookeeper-3.4.6.tar.gz -C /usr/local/zookeeper-cluster</pre><br>3:复制2份zookeeper</p>
<p><pre>[root@localhost ~]# cd /usr/local/zookeeper-cluster/<br>[root@localhost zookeeper-cluster]# mv zookeeper-3.4.6 zookeeper01<br>[root@localhost zookeeper-cluster]# cp -r zookeeper01 zookeeper02 //记得-r 因为zookeeper01下面还有文件<br>[root@localhost zookeeper-cluster]# cp -r zookeeper01 zookeeper03</pre><br>4：分别进入zookeeper目录，创建data和logs文件夹</p>
<p><pre> mkdir /usr/local/zookeeper-cluster/zookeeper01/data<br> mkdir /usr/local/zookeeper-cluster/zookeeper01/logs<br>  mkdir /usr/local/zookeeper-cluster/zookeeper02/data<br> mkdir /usr/local/zookeeper-cluster/zookeeper02/logs<br> mkdir /usr/local/zookeeper-cluster/zookeeper03/data<br> mkdir /usr/local/zookeeper-cluster/zookeeper03/logs</pre><br>5:分别在data文件夹下面新建myid</p>
<p><pre>echo 1 &gt;&gt; /usr/local/zookeeper-cluster/zookeeper01/data/myid<br>echo 2 &gt;&gt; /usr/local/zookeeper-cluster/zookeeper02/data/myid<br>echo 3 &gt;&gt; /usr/local/zookeeper-cluster/zookeeper03/data/myid</pre><br>&nbsp;</p>
<p>6:修改配置文件</p>
<p><pre><span style="color: #ff0000;">拷贝：</span><br>cp /usr/local/zookeeper-cluster/zookeeper01/conf/zoo_sample.cfg /usr/local/zookeeper-cluster/zookeeper01/conf/zoo.cfg</pre></p>
<p>cp /usr/local/zookeeper-cluster/zookeeper02/conf/zoo_sample.cfg /usr/local/zookeeper-cluster/zookeeper02/conf/zoo.cfg</p>
<p>cp /usr/local/zookeeper-cluster/zookeeper03/conf/zoo_sample.cfg /usr/local/zookeeper-cluster/zookeeper03/conf/zoo.cfg<br><span style="color: #ff0000;">修改:</span><br><span style="color: #000000;">vim /usr/local/zookeeper-cluster/zookeeper01/conf/zoo.cfg</span><br><span style="color: #000000;">zookeeper01的配置如下</span><br><span style="color: #3366ff;">tickTime=2000</span><br><span style="color: #3366ff;">initLimit=10</span><br><span style="color: #3366ff;">syncLimit=5</span><br><span style="color: #3366ff;">dataDir=/usr/local/zookeeper-cluster/<span style="color: #ff0000;">zookeeper01</span>/data</span><br><span style="color: #3366ff;">dataLogDir=/usr/local/zookeeper-cluster/<span style="color: #ff0000;">zookeeper01</span>/logs</span><br><span style="color: #3366ff;">clientPort=<span style="color: #ff0000;">2181</span></span><br><span style="color: #3366ff;">server.1=192.168.25.131:2881:3881</span><br><span style="color: #3366ff;">server.2=192.168.25.131:2882:3882</span><br><span style="color: #3366ff;">server.3=192.168.25.131:2883:3883</span><br>其他两个zookeeper就标红位置的不一样</p>
<p>如果你想知道每个配置项是什么意思，请参考<a href="http://139.199.74.187/blog/?p=222" target="_blank" rel="external">zookeeper配置说明</a><br>7:创建批处理同时启动3个zookeeper（生产环境忽略）</p>
<p><pre>vim /usr/local/zookeeper-cluster/start-zoo-all.sh<br>粘贴：<br>cd /usr/local/zookeeper-cluster/zookeeper01/bin<br>./zkServer.sh start<br>cd /usr/local/zookeeper-cluster/zookeeper02/bin<br>./zkServer.sh start<br>cd /usr/local/zookeeper-cluster/zookeeper03/bin<br>./zkServer.sh start</pre></p>
<p>批处理结束zookeeper<br>vim /usr/local/zookeeper-cluster/stop-zoo-all.sh<br>粘贴:<br>cd /usr/local/zookeeper-cluster/zookeeper01/bin<br>./zkServer.sh stop<br>cd /usr/local/zookeeper-cluster/zookeeper02/bin<br>./zkServer.sh stop<br>cd /usr/local/zookeeper-cluster/zookeeper03/bin<br>./zkServer.sh stop</p>
<p>批处理查看zookeeper状态<br>vim /usr/local/zookeeper-cluster/status-zoo-all.sh<br>粘贴:<br>cd /usr/local/zookeeper-cluster/zookeeper01/bin<br>./zkServer.sh status<br>cd /usr/local/zookeeper-cluster/zookeeper02/bin<br>./zkServer.sh status<br>cd /usr/local/zookeeper-cluster/zookeeper03/bin<br>./zkServer.sh status<br>8:设置批处理文件执行权限</p>
<p><pre>[root@localhost zookeeper-cluster]# chmod u+x start-zoo-all.sh<br>[root@localhost zookeeper-cluster]# chmod u+x stop-zoo-all.sh<br>[root@localhost zookeeper-cluster]# chmod u+x status-zoo-all.sh</pre><br>9：执行批处理运行zookeeper集群</p>
<p><pre>[root@localhost zookeeper-cluster]# ./start-zoo-all.sh</pre><br>10：查看zookeeper集群状态</p>
<p><pre>[root@localhost zookeeper-cluster]# ./status-zoo-all.sh<br>状态如下:<br>JMX enabled by default<br>Using config: /usr/local/zookeeper-cluster/zookeeper01/bin/../conf/zoo.cfg<br><span style="color: #ff0000;">Mode: follower</span><br>JMX enabled by default<br>Using config: /usr/local/zookeeper-cluster/zookeeper02/bin/../conf/zoo.cfg<br><span style="color: #ff00ff;">Mode: leader</span><br>JMX enabled by default<br>Using config: /usr/local/zookeeper-cluster/zookeeper03/bin/../conf/zoo.cfg<br><span style="color: #ff0000;">Mode: follower</span></pre><br>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.wendaoxueyuan.com/2017/07/29/zookeeper-e9-9b-86-e7-be-a4-e6-90-ad-e5-bb-ba/" data-id="cj9k57bkm001wyc8vb6pimhhy" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-dubbo-e7-ae-a1-e6-8e-a7-e5-8f-b0-e5-ae-89-e8-a3-85" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/07/28/dubbo-e7-ae-a1-e6-8e-a7-e5-8f-b0-e5-ae-89-e8-a3-85/">Dubbo管控台连接单机</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/07/28/dubbo-e7-ae-a1-e6-8e-a7-e5-8f-b0-e5-ae-89-e8-a3-85/">
            <time datetime="2017-07-28T13:33:32.000Z" itemprop="datePublished">2017-07-28</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/dubbo/">dubbo</a>
    </div>

                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>前提：<a href="http://139.199.74.187/blog/?p=36" target="_blank" rel="external">搭建java运行环境</a></p>
<p>1:上传tomcat和dubbo-admin-2.5.4.war上传到服务器(如果已经上传请飘过)</p>
<p>2:解压解压tomcat到 /usr/local/control目录下</p>
<p><pre>mkdir -p /usr/local/dubbo-control<br>[root@localhost ~]#  tar -zxvf apache-tomcat-7.0.47.tar.gz -C /usr/local/dubbo-control</pre><br>3:在生产环境一般都要清除webapps下面所有的文件</p>
<p><pre>rm -rf /usr/local/dubbo-control/apache-tomcat-7.0.47/webapps/*</pre><br>4:将dubbo-admin-2.5.4.war拷贝到 /usr/local/dubbo-control/apache-tomcat-7.0.47</p>
<p><pre>[root@localhost ~]# cp dubbo-admin-2.5.4.war /usr/local/dubbo-control/apache-tomcat-7.0.47/webapps/</pre><br>5:解压dubbo-admin-2.5.4.war包并报目录命名为ROOT</p>
<p><pre>unzip /usr/local/dubbo-control/apache-tomcat-7.0.47/webapps/dubbo-admin-2.5.4.war -d ROOT</pre><br>6:配置dubbo.properties</p>
<p><pre>vim /usr/local/dubbo-control/apache-tomcat-7.0.47/webapps/ROOT/WEB-INF/dubbo.properties</pre></p>
<p>dubbo.registry.address=zookeeper://<span style="color: #ff0000;">127.0.0.1:2181</span><br>dubbo.admin.root.password=<span style="color: #ff0000;">zhu.123 </span><br>dubbo.admin.guest.password=guest<br><strong>说明:</strong><br>1:如果dubbo管控台和zookeeper不在同一台电脑，那么ip地址要为zookeeper真实ip地址<br>2:建议修改管控台密码<br>7:启动tomcat</p>
<p><pre>启动之前确保zookeeper已经启动<br>/usr/local/dubbo-control/apache-tomcat-7.0.47/bin/startup.sh</pre><br>8:访问管控台</p>
<p><pre>访问之前确保防火墙已经关闭<br>/etc/init.d/iptables stop<br>chkconfig –level 35 iptables off<br><a href="http://192.168.25.131:8080/" target="_blank" rel="external">http://192.168.25.131:8080/</a></pre><br>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.wendaoxueyuan.com/2017/07/28/dubbo-e7-ae-a1-e6-8e-a7-e5-8f-b0-e5-ae-89-e8-a3-85/" data-id="cj9k57bi6000lyc8vgdhr6mdt" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-solr-e6-b7-bb-e5-8a-a0-e4-b8-ad-e6-96-87-e5-88-86-e6-9e-90-e5-99-a8" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/07/28/solr-e6-b7-bb-e5-8a-a0-e4-b8-ad-e6-96-87-e5-88-86-e6-9e-90-e5-99-a8/">solr添加中文分析器</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/07/28/solr-e6-b7-bb-e5-8a-a0-e4-b8-ad-e6-96-87-e5-88-86-e6-9e-90-e5-99-a8/">
            <time datetime="2017-07-28T03:51:48.000Z" itemprop="datePublished">2017-07-28</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/solor/">solor</a>
    </div>

                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>1：上传中文解析器jar包和相关配置文件</p>
<p><img src="http://139.199.74.187/blog/wp-content/uploads/2017/07/2017-07-28_115325-300x91.png" alt=""></p>
<p>2：将jar包拷贝到/usr/local/solr/apache-tomcat-7.0.47/webapps/solr/WEB-INF/lib/</p>
<p><pre>[root@localhost IKanalyzer2012]# cp IKAnalyzer2012FF_u1.jar /usr/local/solr/apache-tomcat-7.0.47/webapps/solr/WEB-INF/lib/</pre><br>3:在solr WEB-INF目录下新建classes</p>
<p><pre>mkdir  /usr/local/solr/apache-tomcat-7.0.47/webapps/solr/WEB-INF/classes</pre><br>4:将配置文件拷贝到classes文件夹下</p>
<p><pre>[root@localhost IKanalyzer2012]# cp ext_stopword.dic IKAnalyzer.cfg.xml mydict.dic /usr/local/solr/apache-tomcat-7.0.47/webapps/solr/WEB-INF/classes/</pre><br>5:配置schema.xml</p>
<p><pre>vim /usr/local/solr/solr_home/collection1/conf/schema.xml<br>末尾加上<br>1：添加FieldType<br>&lt;fieldType name=”text_ik” class=”solr.TextField”&gt;<br>  &lt;analyzer class=”org.wltea.analyzer.lucene.IKAnalyzer”/&gt;<br>&lt;/fieldType&gt;<br>2：配置业务域</pre></p>
<p>&lt;field name=”item_title” type=”text_ik” indexed=”true” stored=”true”/&gt;<br>&lt;field name=”item_sell_point” type=”text_ik” indexed=”true” stored=”true”/&gt;<br>&lt;field name=”item_price”  type=”long” indexed=”true” stored=”true”/&gt;<br>&lt;field name=”item_image” type=”string” indexed=”false” stored=”true” /&gt;<br>&lt;field name=”item_category_name” type=”string” indexed=”true” stored=”true” /&gt;<br>&lt;field name=”item_desc” type=”text_ik” indexed=”true” stored=”false” /&gt;<br>&lt;field name=”item_keywords” type=”text_ik” indexed=”true” stored=”false” multiValued=”true”/&gt;<br>&lt;copyField source=”item_title” dest=”item_keywords”/&gt;<br>&lt;copyField source=”item_sell_point” dest=”item_keywords”/&gt;<br>&lt;copyField source=”item_category_name” dest=”item_keywords”/&gt;<br>&lt;copyField source=”item_desc” dest=”item_keywords”/&gt;<br>6： 重启tomcat</p>
<p>&nbsp;</p>
<p>&nbsp;</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.wendaoxueyuan.com/2017/07/28/solr-e6-b7-bb-e5-8a-a0-e4-b8-ad-e6-96-87-e5-88-86-e6-9e-90-e5-99-a8/" data-id="cj9k57bk1001hyc8vn5hvsk0i" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-solor-e6-9c-8d-e5-8a-a1-e7-9a-84-e5-ae-89-e8-a3-85" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/07/28/solor-e6-9c-8d-e5-8a-a1-e7-9a-84-e5-ae-89-e8-a3-85/">solor单机版服务安装</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/07/28/solor-e6-9c-8d-e5-8a-a1-e7-9a-84-e5-ae-89-e8-a3-85/">
            <time datetime="2017-07-28T01:45:33.000Z" itemprop="datePublished">2017-07-28</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/solor/">solor</a>
    </div>

                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>前提:搭建java运行环境（solor是java写的）</p>
<p>请参考<a href="http://139.199.74.187/blog/?p=36" target="_blank" rel="external">centos搭建java环境</a></p>
<p>1.将下载solr-4.10.3.tgz和apache-tomcat-7.0.47.tar.gz上传到linux服务器中</p>
<p><img src="http://139.199.74.187/blog/wp-content/uploads/2017/07/sdf-1-300x216.jpg" alt=""></p>
<p>2:解压tomcat到/usr/local/solr/</p>
<p><pre>mkdir /usr/local/solr -p</pre></p>
<p>[root@localhost uploadFile]# tar -zxvf apache-tomcat-7.0.47.tar.gz -C /usr/local/solr<br>3:解压solr到/usr/local/solr</p>
<p><pre>[root@localhost uploadFile]# tar -zxvf solr-4.10.3.tgz.tgz -C /usr/local/solr</pre><br>4：将solr   dist文件夹下面的solr-4.10.3.war  移动到tomcat的webapps下面并改为solr.war</p>
<p><pre>cp /usr/local/solr/solr-4.10.3/dist/solr-4.10.3.war /usr/local/solr/apache-tomcat-7.0.47/webapps/solr.war</pre><br>5：启动tomcat，为的是解压solr.war,后续要往这个文件夹加东西</p>
<p><pre>[root@localhost bin]# ./startup.sh</pre><br>6:将/usr/local/solr/solr-4.10.3/example/lib/ext目录下所有的jar拷贝到</p>
<p><pre>[root@localhost ext]# cp * /usr/local/solr/apache-tomcat-7.0.47/webapps/solr/WEB-INF/lib/</pre><br>7:将/usr/local/solr/solr-4.10.3/example/solr拷贝到/usr/local/solr 改名为solr_home</p>
<p><pre>[root@localhost example]# cp solr -r /usr/local/solr/solr_home  <span style="color: #ff0000;"> -r是将solr的内容追加到solr_home</span></pre><br>8：将tomcat solr项目和solr_home关联到一起</p>
<p><pre>vim /usr/local/solr/apache-tomcat-7.0.47/webapps/solr/WEB-INF/web.xml </pre></p>
<p><img src="http://139.199.74.187/blog/wp-content/uploads/2017/07/2017-07-28_105857-300x56.png" alt=""><br>9:重启tomcat</p>
<p>10:<a href="http://192.168.25.130:8080/solr" target="_blank" rel="external">http://192.168.25.130:8080/solr</a></p>
<p><pre><span style="color: #ff0000;">注意：关闭防火墙</span><br>chkconfig iptables off<br>或者<br>开放8080端口</pre><br>&nbsp;</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.wendaoxueyuan.com/2017/07/28/solor-e6-9c-8d-e5-8a-a1-e7-9a-84-e5-ae-89-e8-a3-85/" data-id="cj9k57bjw001fyc8v9vrvjrvn" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-redis-e9-9b-86-e7-be-a4-e4-b9-8bcluster-config-file-e9-85-8d-e7-bd-ae-e9-97-ae-e9-a2-98" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/07/27/redis-e9-9b-86-e7-be-a4-e4-b9-8bcluster-config-file-e9-85-8d-e7-bd-ae-e9-97-ae-e9-a2-98/">Redis集群之cluster-config-file配置问题</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/07/27/redis-e9-9b-86-e7-be-a4-e4-b9-8bcluster-config-file-e9-85-8d-e7-bd-ae-e9-97-ae-e9-a2-98/">
            <time datetime="2017-07-27T09:49:31.000Z" itemprop="datePublished">2017-07-27</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Redis/">Redis</a>
    </div>

                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>创建集群时报错，如下：</p>
<pre>/usr/lib/ruby/gems/1.8/gems/redis-3.0.7/lib/redis/client.rb:97:in `call': ERR Slot 16011 is already busy (Redis::CommandError)
 from /usr/lib/ruby/gems/1.8/gems/redis-3.0.7/lib/redis.rb:2432:in `method_missing'
 from /usr/lib/ruby/gems/1.8/gems/redis-3.0.7/lib/redis.rb:37:in `synchronize'
 from /usr/lib/ruby/1.8/monitor.rb:242:in `mon_synchronize'
 from /usr/lib/ruby/gems/1.8/gems/redis-3.0.7/lib/redis.rb:37:in `synchronize'
 from /usr/lib/ruby/gems/1.8/gems/redis-3.0.7/lib/redis.rb:2431:in `method_missing'
 from ./redis-trib.rb:203:in `flush_node_config'
 from ./redis-trib.rb:571:in `flush_nodes_config'
 from ./redis-trib.rb:570:in `each'
 from ./redis-trib.rb:570:in `flush_nodes_config'
 from ./redis-trib.rb:820:in `create_cluster_cmd'
 from ./redis-trib.rb:1026:in `send'
 from ./redis-trib.rb:1026</pre>
分析原因
<pre>我的所有redis节点 下都有一个名字相同的nodes.conf配置文件,这个文件的文件名是根据redis.conf配置里面的
cluster-config-file  nodes.conf 指定的。
在集群中，该文件不能设置成相同名字，要不然就会出问题。
即使你把nodes.conf全删了重新生成也不行（因为重新生成的也是nodes.conf）

</pre>
解决办法
<pre>1：在每个redis节点下的redis.conf 中配置 cluster-config-file nodes-7001.conf 
 保证cluster-config-file的值不一样 我这里通过端口确保文件名不一样。
2：删除.aof、.rdb、nodes.conf文件
3: 重启虚拟机 重新开启redis节点 重新创建redis集群
</pre>
        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.wendaoxueyuan.com/2017/07/27/redis-e9-9b-86-e7-be-a4-e4-b9-8bcluster-config-file-e9-85-8d-e7-bd-ae-e9-97-ae-e9-a2-98/" data-id="cj9k57bjk0017yc8vwy6zf7n3" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-redis-e5-ad-a6-e4-b9-a0-e4-b9-8b-e9-9b-86-e7-be-a4-e6-8a-a5-e9-94-99node-is-not-empty" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/07/27/redis-e5-ad-a6-e4-b9-a0-e4-b9-8b-e9-9b-86-e7-be-a4-e6-8a-a5-e9-94-99node-is-not-empty/">Redis之集群报错Node is not empty</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/07/27/redis-e5-ad-a6-e4-b9-a0-e4-b9-8b-e9-9b-86-e7-be-a4-e6-8a-a5-e9-94-99node-is-not-empty/">
            <time datetime="2017-07-27T08:59:11.000Z" itemprop="datePublished">2017-07-27</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Redis/">Redis</a>
    </div>

                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>继上一篇<a href="http://139.199.74.187/blog/?p=164" target="_blank" rel="external">Redis集群的搭建</a>完成之后，当然要用客户端JedisCluster简单测试一下集群啦，这样就要将Redis.conf里bind 127.0.0.1改成bind +真机ip(我的192.168.25.129),当创建集群的时候就报错了</p>
<p><pre><span style="color: #ff0000;">说明:</span><br>在本次创建集群之前，我已经创建过一次集群，但是那时候redis.conf里面bind参数值是127.0.0.1<br>这次修改bind值为真机ip</pre></p>
<blockquote>
<p><pre>异常:</pre></p>
<p>&gt;&gt; Creating cluster</p>
<p>[ERR] Node 192.168.25.129:7004 is not empty. Either the node already knows other nodes (check with CLUSTER NODES) or contains some key in database 0.</p>
<p>[root@zhuximingdediannao redis-cluster]#<br>分析原因</p>
<p><pre>第一次创建集群的时候（bind 为127.0.0.1）生成了appendonly.aof dump.rdb nodes.conf三个文件，这三个文件无法直接被覆盖所以就出问题了。<br>appendonly.aof:当开启aof持久化模式时会产生，里面记录的是所有的增删改命令操作<br>dump.rdb      :默认持久化模式，定期将数据从内存同步到磁盘<br>nodes.conf    :当创建集群时产生,记录主从节点等信息</pre></p>
</blockquote>
<p><br>解决办法</p>
<p><pre>1)将每个节点下aof、rdb、nodes.conf本地备份文件删除；<br>2)192.168.25.129:7001&gt; flushdb #清空当前数据库<br>3)之后再执行创建集群脚本，成功执行；</pre><br>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>

        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.wendaoxueyuan.com/2017/07/27/redis-e5-ad-a6-e4-b9-a0-e4-b9-8b-e9-9b-86-e7-be-a4-e6-8a-a5-e9-94-99node-is-not-empty/" data-id="cj9k57bjd0012yc8vol69liq2" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <article id="post-redis-e9-9b-86-e7-be-a4-e7-9a-84-e6-90-ad-e5-bb-ba" class="article article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
        
            <header class="article-header">
                
    
        <h1 itemprop="name">
            <a class="article-title" href="/2017/07/27/redis-e9-9b-86-e7-be-a4-e7-9a-84-e6-90-ad-e5-bb-ba/">Redis集群的搭建</a>
        </h1>
    

                
                    <div class="article-meta">
                        
    <div class="article-date">
        <i class="fa fa-calendar"></i>
        <a href="/2017/07/27/redis-e9-9b-86-e7-be-a4-e7-9a-84-e6-90-ad-e5-bb-ba/">
            <time datetime="2017-07-27T03:25:20.000Z" itemprop="datePublished">2017-07-27</time>
        </a>
    </div>


                        
    <div class="article-category">
    	<i class="fa fa-folder"></i>
        <a class="article-category-link" href="/categories/Redis/">Redis</a><i class="fa fa-angle-right"></i><a class="article-category-link" href="/categories/Redis/未分类/">未分类</a>
    </div>

                        
                    </div>
                
            </header>
        
        
        <div class="article-entry" itemprop="articleBody">
        
            
            <p>由于redis判断一个节点fail，是通过投票决定的，如果<span style="color: #ff0000;">超过</span>半数节点认定该节点宕机则判定该节点fail，所以至少得有3台服务器，由于每台redis主服务器的数据是存在差异的，为了防止宕机后系统无法运行，所以每台redis主服务器至少得有一台备份机，这样一算 redis集群中至少得有6台服务器</p>
<pre>一台虚拟机开启六个redis实例，运行在6个端口上 
                                             ---伪集群</pre>
1:在root用户的家目录下新建一个redis-cluster文件夹
<pre>[root@localhost ~]# mkdir redis-cluster</pre>
2:将已经安装好的单机版redis 拷贝6份
<pre>cp<span style="color: #ff0000;"> /usr/local/redis/</span>bin    /root/redis-cluster/redis01 -r    标红为我的redis安装目录
cp /usr/local/redis/bin    /root/redis-cluster/redis02 -r 
cp /usr/local/redis/bin    /root/redis-cluster/redis03 -r 
cp /usr/local/redis/bin    /root/redis-cluster/redis04 -r 
cp /usr/local/redis/bin    /root/redis-cluster/redis05 -r 
cp /usr/local/redis/bin    /root/redis-cluster/redis06 -r</pre>
3：切换到redis节点删除每个redis节点已经存在的数据
<pre>rm -rf dump.rdb
rm -rf appendonly.aof</pre>
4:修改每个redis配置文件
<pre>vim  /root/redis-cluster/redis01/redis.conf
修改 daemonize yes
修改 端口port                               （<span style="color: #ff0000;">每个节点对应端口不要一样</span>）
修改 cluster-enabled yes
修改  bind 192.168.25.129(本机ip,<span style="color: #ff0000;">这个一定要做，不然就悲剧了</span>)
修改 cluster-config-file nodes-7001.conf   （<span style="color: #ff0000;">每个节点对应值不要一样</span>）
修改dir ./  (<span style="color: #ff0000;">dir是指定数据存放的地方，目录应该为redis节点根目录</span>)</pre>
5：通过编写批处理文件一次性开启6个redis节点
<pre>touch /root/cluster-redis/startall.sh
vim   /root/cluster-redis/startall.sh
内容如下:

cd redis01
./redis-server redis.conf
cd ..

cd redis02
./redis-server redis.conf
cd ..

cd redis03
./redis-server redis.conf
cd ..

cd redis04
./redis-server redis.conf
cd ..

cd redis05
./redis-server redis.conf
cd ..

cd redis06
./redis-server redis.conf</pre>
6:修改startall.sh 执行权限
<pre><span style="color: #00ff00;">-rw-r--r--. 1 root root 263 Jul 26 20:25 startall.sh   修改前</span>
当前用户无法执行startall.sh
chmod u+x startall.sh
<span style="color: #00ff00;">-rwxr--r--. 1 root root 263 Jul 26 20:25 startall.sh   修改后</span></pre>
7：启动
<pre>[root@localhost redis-cluster]# ./startall.sh</pre>
8:验证启动
<pre> ps aux|grep redis-server</pre>
9:使用ruby脚本搭建集群
<pre>安装ruby
  请确保你的虚拟机网络配置是NAT,如果是Host only 那么此时虚拟机就不能访问外界互联网了。
  1:在联网的前提下，使用yum install ruby
  2:再使用yum install rubygems
   3:gem install redis-3.0.0.gem (先上传redis-3.0.0.gem到服务器)
<span style="color: #00ff00;">   ruby依赖rubygems redis-trib.rb依赖redis-3.0.0.gem</span></pre>
10:将ruby脚本文件拷贝到/root/redis-cluster目录下
<pre>  我的脚本文件在/home/zhuximing/redis-3.2.9/src（源码包） 目录下 文件名为redis-trib.rb
   执行 ll *.rb命令可以查看到
![](http://139.199.74.187/blog/wp-content/uploads/2017/07/2017-07-27_115018-300x24.png)  
 cp redis-trib.rb /root/redis-cluster/
  ![](http://139.199.74.187/blog/wp-content/uploads/2017/07/2017-07-27_115319-300x66.png)

</pre>
11:执行ruby脚本创建集群
<pre>./redis-trib.rb  create --replicas 1 192.168.25.129:7001 192.168.25.129:7002 192.168.25.129:7003 192.168.25.129:7004 192.168.25.129:7005 192.168.25.129:7006
<span style="color: #ff0000;">解释:</span>
    ./redis-trib.rb  脚本
     create           创建集群   
    --replicas 1      备份机只需1台
![](http://139.199.74.187/blog/wp-content/uploads/2017/07/2017-07-27_131551-300x128.png)</pre>
12：使用redis-cli连接redis集群
<pre>使用redis-clis命令开启客户端连接
选择一份redis，执行redis-cli命令需要注意的是需要加上-c 代表连接集群
eg：redis01/redis-cli -p 7001 -**<span style="color: #ff0000;">c

</span>**
# Keyspace
192.168.25.129:7001&gt; set name zhuximing    <span style="color: #ff0000;">计算key对应的slot 通过slot定位到对应的节点</span>
-&gt; Redirected to slot [5798] located at 192.168.25.129:7002
OK
192.168.25.129:7002&gt; get name
"zhuximing"
192.168.25.129:7002&gt; set age 18
-&gt; Redirected to slot [741] located at 192.168.25.129:7001
OK
192.168.25.129:7001&gt; get age
"18"
192.168.25.129:7001&gt;

</pre>
        
        </div>
        <footer class="article-footer">
            <div class="share-container">



</div>

    <a data-url="http://www.wendaoxueyuan.com/2017/07/27/redis-e9-9b-86-e7-be-a4-e7-9a-84-e6-90-ad-e5-bb-ba/" data-id="cj9k57bju001cyc8vrwy9uleq" class="article-share-link"><i class="fa fa-share"></i>分享到</a>
<script>
    (function ($) {
        // Prevent duplicate binding
        if (typeof(__SHARE_BUTTON_BINDED__) === 'undefined' || !__SHARE_BUTTON_BINDED__) {
            __SHARE_BUTTON_BINDED__ = true;
        } else {
            return;
        }
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="fa fa-twitter article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="fa fa-facebook article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="fa fa-pinterest article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="fa fa-google article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

            
    

        </footer>
    </div>
    
</article>



    <nav id="page-nav">
        <a class="extend prev" rel="prev" href="/">&laquo; 上一页</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">下一页 &raquo;</a>
    </nav>
</section>
            
                
<aside id="sidebar">
   
        
    <div class="widget-wrap">
        <h3 class="widget-title">分类</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Docker/">Docker</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA-WEB/">JAVA_WEB</a><span class="category-list-count">3</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/JAVA-WEB/未分类/">未分类</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/NodeJs/">NodeJs</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Redis/">Redis</a><span class="category-list-count">6</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Redis/未分类/">未分类</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/dubbo/">dubbo</a><span class="category-list-count">6</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/dubbo/未分类/">未分类</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/fastDFS/">fastDFS</a><span class="category-list-count">2</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/fastDFS/未分类/">未分类</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/linux/">linux</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/nginx/">nginx</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/solor/">solor</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/前端技术/">前端技术</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/服务安装/">服务安装</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/未分类/">未分类</a><span class="category-list-count">1</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/未分类/消息队列（activeMQ）/">消息队列（activeMQ）</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/消息队列（activeMQ）/">消息队列（activeMQ）</a><span class="category-list-count">1</span></li></ul>
        </div>
    </div>

    
        
    <div class="widget-wrap">
        <h3 class="widget-title">归档</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">十一月 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">八月 2017</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">七月 2017</a><span class="archive-list-count">20</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">六月 2017</a><span class="archive-list-count">6</span></li></ul>
        </div>
    </div>

    
        
    
        
    
        
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">链接</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://www.wendaoxueyuan.com">问道学院</a>
                    </li>
                
            </ul>
        </div>
    </div>


    
    <div id="toTop" class="fa fa-angle-up"></div>
</aside>

            
        </div>
        <footer id="footer">
    <div class="outer">
        <div id="footer-info" class="inner">
            &copy; 2017 朱锡铭<br>
            Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>. Theme by <a href="http://github.com/ppoffice">PPOffice</a>
        </div>
    </div>
</footer>
        


    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>